<div class="employee-portal">
  <!-- Header Section -->
  <div class="portal-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col">
          <h1 class="page-title">
            <i class="fas fa-users text-primary me-3"></i>
            Employee Management
          </h1>
          <p class="page-subtitle text-muted mb-0">
            Manage your team members and organizational structure
          </p>
        </div>
        <div class="col-auto">
          <button
            class="btn btn-primary btn-lg d-flex align-items-center"
            (click)="toggleForm()"
            [disabled]="isLoading"
          >
            <i
              class="fas me-2"
              [ngClass]="isFormVisible ? 'fa-times' : 'fa-plus'"
            ></i>
            {{ isFormVisible ? "Close Form" : "Add Employee" }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container-fluid mt-4">
    <div class="row g-4">
      <!-- Employee Table Section -->
      <div class="col-12" [ngClass]="{ 'col-lg-8': isFormVisible }">
        <div class="table-card">
          <!-- Table Header -->
          <div class="table-header">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h4 class="mb-1 fw-bold text-gray-800">Employee Directory</h4>
                <p class="text-muted mb-0" *ngIf="employees.length > 0">
                  {{ employees.length }} total employees
                </p>
              </div>
              <div class="d-flex gap-2" *ngIf="employees.length > 0">
                <button class="btn btn-outline-secondary btn-sm">
                  <i class="fas fa-download me-1"></i>Export
                </button>
                <button class="btn btn-outline-secondary btn-sm">
                  <i class="fas fa-filter me-1"></i>Filter
                </button>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div
            *ngIf="isLoading && employees.length === 0"
            class="loading-state"
          >
            <div class="loading-spinner">
              <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem"></div>
              <h5 class="text-muted mb-2">Loading employees...</h5>
              <p class="text-muted">Please wait while we fetch the data</p>
            </div>
          </div>

          <!-- Empty State -->
          <div
            *ngIf="!isLoading && employees.length === 0"
            class="empty-state"
          >
            <div class="empty-icon">
              <i class="fas fa-users"></i>
            </div>
            <h4 class="empty-title">No employees found</h4>
            <p class="empty-description">
              Start building your team by adding your first employee to the system.
            </p>
            <button
              class="btn btn-primary btn-lg"
              (click)="toggleForm()"
              *ngIf="!isFormVisible"
            >
              <i class="fas fa-plus me-2"></i>Add First Employee
            </button>
          </div>

          <!-- Employee Table -->
          <div *ngIf="employees.length > 0" class="table-container">
            <div class="table-responsive">
              <table class="table employee-table">
                <thead>
                  <tr>
                    <th class="employee-id">
                      <i class="fas fa-hashtag me-2"></i>ID
                    </th>
                    <th class="employee-name">
                      <i class="fas fa-user me-2"></i>Employee
                    </th>
                    <th class="contact-info">
                      <i class="fas fa-phone me-2"></i>Contact
                    </th>
                    <th class="email-info">
                      <i class="fas fa-envelope me-2"></i>Email
                    </th>
                    <th class="department-info">
                      <i class="fas fa-building me-2"></i>Department
                    </th>
                    <th class="role-info">
                      <i class="fas fa-user-tag me-2"></i>Role
                    </th>
                    <th class="actions-column">
                      <i class="fas fa-cogs me-2"></i>Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let emp of employees; let i = index"
                    class="employee-row"
                  >
                    <td class="employee-id">
                      <span class="employee-id-badge">
                        #{{ (emp._id | slice : -6).toUpperCase() }}
                      </span>
                    </td>
                    <td class="employee-name">
                      <div class="employee-info">
                        <div class="employee-avatar">
                          <span>{{ emp.employeeName.charAt(0).toUpperCase() }}</span>
                        </div>
                        <div class="employee-details">
                          <div class="name">{{ emp.employeeName }}</div>
                          <div class="position text-muted">{{ emp.role | titlecase }}</div>
                        </div>
                      </div>
                    </td>
                    <td class="contact-info">
                      <div class="contact-item">
                        <i class="fas fa-phone text-muted me-2"></i>
                        <span>{{ emp.contactNo }}</span>
                      </div>
                    </td>
                    <td class="email-info">
                      <div class="email-item">
                        <a href="mailto:{{ emp.email }}" class="email-link">
                          {{ emp.email }}
                        </a>
                      </div>
                    </td>
                    <td class="department-info">
                      <div class="department-badges">
                        <span class="badge department-badge">
                          {{ emp.department }}
                        </span>
                        <span
                          *ngIf="emp.subDepartment"
                          class="badge subdepartment-badge"
                        >
                          {{ emp.subDepartment }}
                        </span>
                      </div>
                    </td>
                    <td class="role-info">
                      <span class="role-badge" [ngClass]="'role-' + emp.role">
                        {{ emp.role | titlecase }}
                      </span>
                    </td>
                    <td class="actions-column">
                      <div class="action-buttons">
                        <button
                          class="btn btn-action btn-edit"
                          title="Edit Employee"
                        >
                          <i class="fas fa-edit"></i>
                        </button>
                        <button
                          class="btn btn-action btn-view"
                          title="View Details"
                        >
                          <i class="fas fa-eye"></i>
                        </button>
                        <button
                          class="btn btn-action btn-delete"
                          title="Delete Employee"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Table Footer -->
            <div class="table-footer">
              <div class="row align-items-center">
                <div class="col">
                  <div class="table-info">
                    <i class="fas fa-info-circle me-2 text-primary"></i>
                    Showing <strong>{{ employees.length }}</strong> employees
                  </div>
                </div>
                <div class="col-auto">
                  <nav aria-label="Employee pagination">
                    <!-- Pagination controls can be added here -->
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Employee Form Section -->
      <div class="col-12 col-lg-4" *ngIf="isFormVisible">
        <div class="form-card">
          <div class="form-header">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h4 class="form-title">
                  <i class="fas fa-user-plus me-2"></i>Add New Employee
                </h4>
                <p class="form-subtitle">Fill in the employee details below</p>
              </div>
              <button
                class="btn btn-close-form"
                (click)="toggleForm()"
                title="Close Form"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <div class="form-body">
            <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()" novalidate>
              <!-- Personal Information Section -->
              <div class="form-section">
                <div class="section-header">
                  <h5 class="section-title">
                    <i class="fas fa-user me-2"></i>Personal Information
                  </h5>
                </div>

                <!-- Full Name -->
                <div class="form-group">
                  <label for="employeeName" class="form-label">
                    Full Name <span class="required">*</span>
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="employeeName"
                    formControlName="employeeName"
                    placeholder="Enter employee's full name"
                    [ngClass]="{
                      'is-invalid': f['employeeName'].touched && f['employeeName'].errors
                    }"
                  />
                  <div
                    *ngIf="f['employeeName'].touched && f['employeeName'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['employeeName'].errors?.['required']">
                      Full name is required
                    </div>
                    <div *ngIf="f['employeeName'].errors?.['minlength']">
                      Name must be at least 3 characters long
                    </div>
                  </div>
                </div>

                <!-- Gender -->
                <div class="form-group">
                  <label for="gender" class="form-label">
                    Gender <span class="required">*</span>
                  </label>
                  <select
                    class="form-select"
                    id="gender"
                    formControlName="gender"
                    [ngClass]="{
                      'is-invalid': f['gender'].touched && f['gender'].errors
                    }"
                  >
                    <option value="" disabled selected>Select gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                  <div
                    *ngIf="f['gender'].touched && f['gender'].errors"
                    class="invalid-feedback"
                  >
                    Please select a gender
                  </div>
                </div>
              </div>

              <!-- Contact Information Section -->
              <div class="form-section">
                <div class="section-header">
                  <h5 class="section-title">
                    <i class="fas fa-address-book me-2"></i>Contact Information
                  </h5>
                </div>

                <!-- Contact Number -->
                <div class="form-group">
                  <label for="contactNo" class="form-label">
                    Phone Number <span class="required">*</span>
                  </label>
                  <input
                    type="tel"
                    class="form-control"
                    id="contactNo"
                    formControlName="contactNo"
                    placeholder="Enter phone number"
                    [ngClass]="{
                      'is-invalid': f['contactNo'].touched && f['contactNo'].errors
                    }"
                  />
                  <div
                    *ngIf="f['contactNo'].touched && f['contactNo'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['contactNo'].errors?.['required']">
                      Phone number is required
                    </div>
                    <div *ngIf="f['contactNo'].errors?.['pattern']">
                      Please enter a valid phone number
                    </div>
                  </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                  <label for="email" class="form-label">
                    Email Address <span class="required">*</span>
                  </label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    formControlName="email"
                    placeholder="Enter email address"
                    [ngClass]="{
                      'is-invalid': f['email'].touched && f['email'].errors
                    }"
                  />
                  <div
                    *ngIf="f['email'].touched && f['email'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['email'].errors?.['required']">
                      Email address is required
                    </div>
                    <div *ngIf="f['email'].errors?.['email']">
                      Please enter a valid email address
                    </div>
                  </div>
                </div>
              </div>

              <!-- Work Information Section -->
              <div class="form-section">
                <div class="section-header">
                  <h5 class="section-title">
                    <i class="fas fa-briefcase me-2"></i>Work Information
                  </h5>
                </div>

                <!-- Role -->
                <div class="form-group">
                  <label for="role" class="form-label">
                    Role <span class="required">*</span>
                  </label>
                  <select
                    class="form-select"
                    id="role"
                    formControlName="role"
                    [ngClass]="{
                      'is-invalid': f['role'].touched && f['role'].errors
                    }"
                  >
                    <option value="" disabled selected>Select role</option>
                    <option value="employee">Employee</option>
                    <option value="admin">Admin</option>
                    <option value="user">User</option>
                    <option value="superadmin">Super Admin</option>
                  </select>
                  <div
                    *ngIf="f['role'].touched && f['role'].errors"
                    class="invalid-feedback"
                  >
                    Please select a role
                  </div>
                </div>

                <!-- Department -->
                <div class="form-group">
                  <label for="department" class="form-label">
                    Department <span class="required">*</span>
                  </label>
                  <select
                    class="form-select"
                    id="department"
                    formControlName="department"
                    [ngClass]="{
                      'is-invalid': f['department'].touched && f['department'].errors
                    }"
                    (change)="onParentDepartmentChange($event)"
                  >
                    <option value="" disabled selected>Select department</option>
                    <option
                      *ngFor="let dept of parentDepartments"
                      [value]="dept.departmentName"
                    >
                      {{ dept.departmentName }}
                    </option>
                  </select>
                  <div
                    *ngIf="f['department'].touched && f['department'].errors"
                    class="invalid-feedback"
                  >
                    Please select a department
                  </div>
                </div>

                <!-- Sub-Department -->
                <div class="form-group">
                  <label for="subDepartment" class="form-label">
                    Sub-Department
                  </label>
                  <select
                    class="form-select"
                    id="subDepartment"
                    formControlName="subDepartment"
                    [disabled]="!selectedParentDeptId || childDepartments.length === 0"
                  >
                    <option value="" disabled selected>Select sub-department</option>
                    <option
                      *ngFor="let subDept of childDepartments"
                      [value]="subDept.departmentName"
                    >
                      {{ subDept.departmentName }}
                    </option>
                  </select>
                  <div class="form-text" *ngIf="!selectedParentDeptId">
                    <i class="fas fa-info-circle me-1"></i>
                    Select a department first to enable sub-departments
                  </div>
                </div>
              </div>

              <!-- Security Section -->
              <div class="form-section">
                <div class="section-header">
                  <h5 class="section-title">
                    <i class="fas fa-lock me-2"></i>Security
                  </h5>
                </div>

                <!-- Password -->
                <div class="form-group">
                  <label for="password" class="form-label">
                    Password <span class="required">*</span>
                  </label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    formControlName="password"
                    placeholder="Enter secure password"
                    [ngClass]="{
                      'is-invalid': f['password'].touched && f['password'].errors
                    }"
                  />
                  <div
                    *ngIf="f['password'].touched && f['password'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['password'].errors?.['required']">
                      Password is required
                    </div>
                    <div *ngIf="f['password'].errors?.['minlength']">
                      Password must be at least 6 characters long
                    </div>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button
                  type="submit"
                  class="btn btn-primary btn-lg w-100"
                  [disabled]="isLoading || employeeForm.invalid"
                >
                  <span
                    *ngIf="isLoading"
                    class="spinner-border spinner-border-sm me-2"
                    role="status"
                  ></span>
                  <i *ngIf="!isLoading" class="fas fa-user-plus me-2"></i>
                  {{ isLoading ? "Adding Employee..." : "Add Employee" }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
